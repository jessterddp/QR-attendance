<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Manage Students</title>
<link rel="stylesheet" href="style.css">

<!-- QRCode library (if needed) -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
</head>
<body>
<div class="header">
  <a href="index.html" class="back-btn">‚Üê Back to Dashboard</a>
  <h1>üë• Manage Students</h1>
</div>

<div class="container">
  <!-- Add Student Form -->
  <div class="form-card">
    <h2>Add New Student</h2>
    <form id="addStudentForm">
      <div class="form-group">
        <label for="student_number">Student Number *</label>
        <input type="number" id="student_number" required placeholder="e.g., 2024001" />
      </div>
      <div class="form-group">
        <label for="name">Full Name *</label>
        <input type="text" id="name" required placeholder="e.g., John Smith" />
      </div>
      <div class="form-group">
        <label for="grade_level">Grade Level *</label>
        <input type="number" id="grade_level" required placeholder="e.g., 7" />
      </div>

      <!-- Section dropdown with addable options -->
      <div class="form-group">
        <label for="section">Section *</label>
        <select id="section" required></select>
        <input type="text" id="newSectionInput" placeholder="Type new section and press Enter" />
      </div>

      <button type="submit" class="btn btn-primary">Add Student</button>
    </form>
  </div>

  <!-- Student List Table -->
  <div class="table-card">
    <h2>Student List</h2>
    <div class="search-box">
      <input type="text" id="searchInput" placeholder="üîç Search by name or student number..." />
    </div>
    <div class="table-wrapper">
      <table>
        <thead>
          <tr>
            <th>Student Number</th>
            <th>Name</th>
            <th>Grade Level</th>
            <th>Section</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody id="studentsTable"></tbody>
      </table>
    </div>
  </div>
</div>

<!-- Edit Modal -->
<div id="editModal" class="modal">
  <div class="modal-content">
    <span class="close">&times;</span>
    <h2>Edit Student</h2>
    <form id="editStudentForm">
      <input type="hidden" id="edit_student_number" />
      <div class="form-group">
        <label for="edit_name">Full Name *</label>
        <input type="text" id="edit_name" required />
      </div>
      <div class="form-group">
        <label for="edit_grade_level">Grade Level *</label>
        <input type="number" id="edit_grade_level" required />
      </div>
      <div class="form-group">
        <label for="edit_section">Section *</label>
        <select id="edit_section" required></select>
        <input type="text" id="newEditSectionInput" placeholder="Type new section and press Enter" />
      </div>
      <button type="submit" class="btn btn-primary">Update Student</button>
    </form>
  </div>
</div>

<!-- Students Manager JS as module -->
<script type="module" src="students-manager.js"></script>

<!-- Script for persistent custom section list -->
<script>
  const defaultSections = ["A", "B", "C", "D", "E"];

  function loadSections() {
    // Get saved sections or default
    const saved = JSON.parse(localStorage.getItem("sections")) || defaultSections;
    return saved;
  }

  function saveSections(sections) {
    localStorage.setItem("sections", JSON.stringify(sections));
  }

  function populateSectionDropdown(select, sections) {
    select.innerHTML = "";
    const placeholder = document.createElement("option");
    placeholder.value = "";
    placeholder.textContent = "Select or Add Section";
    select.appendChild(placeholder);

    sections.forEach(sec => {
      const opt = document.createElement("option");
      opt.value = sec;
      opt.textContent = sec;
      select.appendChild(opt);
    });
  }

  function setupDynamicSectionInput(selectId, inputId) {
    const select = document.getElementById(selectId);
    const input = document.getElementById(inputId);
    let sections = loadSections();

    populateSectionDropdown(select, sections);

    input.addEventListener("keypress", (e) => {
      if (e.key === "Enter" && input.value.trim() !== "") {
        e.preventDefault();
        const newSection = input.value.trim();

        // Check if already exists
        if (!sections.includes(newSection)) {
          sections.push(newSection);
          saveSections(sections);
          populateSectionDropdown(select, sections);
        }

        select.value = newSection;
        input.value = "";
      }
    });
  }

  // Initialize both dropdowns on page load
  document.addEventListener("DOMContentLoaded", () => {
    setupDynamicSectionInput("section", "newSectionInput");
    setupDynamicSectionInput("edit_section", "newEditSectionInput");
  });
</script>
</body>
</html>
